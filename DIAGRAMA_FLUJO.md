# ğŸ“Š Diagrama de Flujo - Arquitectura Batalla Naval

## ğŸ—ï¸ ARQUITECTURA ACTUAL (CON PROBLEMAS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React)                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GameService.js (Socket.io)                           â”‚   â”‚
â”‚  â”‚ - Conecta a: ngrok WebSocket                         â”‚   â”‚
â”‚  â”‚ - Eventos: create-game, join-game, place-ships, etc  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Componentes (Juego.jsx, CrearPartida.jsx, etc)      â”‚   â”‚
â”‚  â”‚ - Escuchan eventos custom: gameCreated, playerJoinedâ”‚   â”‚
â”‚  â”‚ - Actualizan estado React                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 â”‚                 â”‚
    (1) WebSocket      (2) Â¿API REST?   (3) Socket.io
          â”‚                 â”‚                 â”‚
          â–¼                 â–¼                 â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Node.js)                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ index.js                                             â”‚   â”‚
â”‚  â”‚ - Servidor Express + Socket.io                       â”‚   â”‚
â”‚  â”‚ - Rutas REST: /api/games/create, /api/games/:id/etc  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                  â”‚               â”‚
â”‚           â–¼                                  â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GameController       â”‚  â”‚ SocketHandler                â”‚ â”‚
â”‚  â”‚ - createGame()       â”‚  â”‚ - handleCreateGame()         â”‚ â”‚
â”‚  â”‚ - joinGame()         â”‚  â”‚ - handleJoinGame()           â”‚ â”‚
â”‚  â”‚ - setShips()         â”‚  â”‚ - handlePlaceShips()         â”‚ â”‚
â”‚  â”‚ - makeShot()         â”‚  â”‚ - handleMakeShot()           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                          â”‚                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GameService.js (âŒ NO USADO - CONFUSIÃ“N)             â”‚   â”‚
â”‚  â”‚ - Usa WebSocket puro (incompatible)                  â”‚   â”‚
â”‚  â”‚ - Duplica lÃ³gica                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                                                  â”‚
â”‚           â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Game Models                                          â”‚   â”‚
â”‚  â”‚ - Game.js                                            â”‚   â”‚
â”‚  â”‚ - Player.js                                          â”‚   â”‚
â”‚  â”‚ - Board.js                                           â”‚   â”‚
â”‚  â”‚ - Ship.js                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… ARQUITECTURA CORREGIDA (OBJETIVO)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React)                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GameService.js (Socket.io) - MEJORADO                â”‚   â”‚
â”‚  â”‚ âœ… Conecta a: ngrok con reconexiÃ³n automÃ¡tica       â”‚   â”‚
â”‚  â”‚ âœ… Eventos: create-game, join-game, place-ships, etcâ”‚   â”‚
â”‚  â”‚ âœ… Manejo de errores y timeouts                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                    â”‚
â”‚                   Socket.io (WebSocket)                      â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Componentes (Juego.jsx, CrearPartida.jsx, etc)      â”‚   â”‚
â”‚  â”‚ âœ… Validan estado recibido                          â”‚   â”‚
â”‚  â”‚ âœ… Manejan errores gracefully                        â”‚   â”‚
â”‚  â”‚ âœ… Sincronizados con SocketHandler                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    Socket.io Connection
                            â”‚
                            â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Node.js)                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ index.js - CONFIGURACIÃ“N CENTRAL                     â”‚   â”‚
â”‚  â”‚ âœ… Servidor Express + Socket.io (Â¡SOLO UNO!)       â”‚   â”‚
â”‚  â”‚ âœ… Rutas REST para debug (opcional)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SocketHandler - CENTRO DE CONTROL                    â”‚   â”‚
â”‚  â”‚ âœ… handleConnection(socket)                          â”‚   â”‚
â”‚  â”‚ âœ… handleCreateGame() â†’ Emite gameState             â”‚   â”‚
â”‚  â”‚ âœ… handleJoinGame() â†’ Sincroniza ambos jugadores    â”‚   â”‚
â”‚  â”‚ âœ… handlePlaceShips() â†’ Verifica readiness          â”‚   â”‚
â”‚  â”‚ âœ… handleMakeShot() â†’ Alterna turnos                â”‚   â”‚
â”‚  â”‚ âœ… handleDisconnect() â†’ Limpia recursos             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ GameController - LÃ“GICA DE NEGOCIO                   â”‚   â”‚
â”‚  â”‚ âœ… createGame()                                      â”‚   â”‚
â”‚  â”‚ âœ… joinGame() - MEJORADO                             â”‚   â”‚
â”‚  â”‚ âœ… setShips()                                        â”‚   â”‚
â”‚  â”‚ âœ… makeShot()                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Game Models                                          â”‚   â”‚
â”‚  â”‚ âœ… Game.js                                           â”‚   â”‚
â”‚  â”‚ âœ… Player.js (con IA mejorada)                       â”‚   â”‚
â”‚  â”‚ âœ… Board.js                                          â”‚   â”‚
â”‚  â”‚ âœ… Ship.js                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  âŒ ELIMINADO: backend/service/GameService.js               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUJO DE EVENTOS - MULTIJUGADOR

### Escenario: Jugador 1 crea partida

```
FRONTEND PLAYER 1                        BACKEND                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Click "Crear"   â”‚
â”‚ gameService.    â”‚
â”‚ createGame()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Socket.emit('create-game', {playerName})
         â”‚
         â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                      â”‚ SocketHandler.handleCreate   â”‚
         â”‚                      â”‚ - Genera gameCode            â”‚
         â”‚                      â”‚ - Llama GameController       â”‚
         â”‚                      â”‚ - Crea Game object           â”‚
         â”‚                      â”‚ - Emite 'game-created'       â”‚
         â”‚                      â”‚   âœ… CON gameState            â”‚
         â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                             â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                             â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚ Socket listener 'game-created'        â”‚
    â”‚ event = {                             â”‚
    â”‚   gameCode: "ABC123",                 â”‚
    â”‚   gameId: "game_1234_xyz",            â”‚
    â”‚   âœ… gameState: {...},                 â”‚
    â”‚ }                                     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Mostrar cÃ³digo "ABC123" en pantalla          â”‚
    â”‚ Esperar que otro jugador se una              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Escenario: Jugador 2 se une a partida

```
FRONTEND PLAYER 2                    BACKEND              FRONTEND PLAYER 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input: "ABC123"  â”‚
â”‚ gameService.     â”‚
â”‚ joinGame()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Socket.emit('join-game', {gameCode, playerName})
         â”‚
         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚ SocketHandler.          â”‚
         â”‚                  â”‚ handleJoinGame()        â”‚
         â”‚                  â”‚ - Valida gameCode       â”‚
         â”‚                  â”‚ - Agrega Player 2       â”‚
         â”‚                  â”‚ - âœ… EMITE A P1:        â”‚
         â”‚                  â”‚   'player-joined'       â”‚
         â”‚                  â”‚   + gameState(1)        â”‚
         â”‚                  â”‚ - EMITE A P2:           â”‚
         â”‚                  â”‚   'player-joined'       â”‚
         â”‚                  â”‚   + gameState(2)        â”‚
         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                            â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚ P2 recibe â”‚          â”‚ P1 recibe eventoâ”‚
    â”‚ player-   â”‚          â”‚ player-joined   â”‚
    â”‚ joined    â”‚          â”‚ + gameState     â”‚
    â”‚ evento    â”‚          â”‚ P1 ahora sabe   â”‚
    â”‚ + estado  â”‚          â”‚ que llegÃ³ P2    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Escenario: Realizar disparo durante el juego

```
FRONTEND (TURNO ACTUAL)              BACKEND                FRONTEND (RIVAL)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Click celda [5,3]   â”‚
â”‚ gameService.        â”‚
â”‚ makeShot(5, 3)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Socket.emit('make-shot', {gameId, row: 5, col: 3})
         â”‚
         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚ SocketHandler.handleMakeShot()â”‚
         â”‚                  â”‚ - Valida turno                â”‚
         â”‚                  â”‚ - GameController.makeShot()   â”‚
         â”‚                  â”‚ - Procesa impacto/fallo       â”‚
         â”‚                  â”‚ - Alterna turno               â”‚
         â”‚                  â”‚ - Emite 'shot-result' A AMBOS â”‚
         â”‚                  â”‚   âœ… gameState(1) y state(2)  â”‚
         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                            â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Recibe 'shot-result'  â”‚   â”‚ Recibe 'shot-result'   â”‚
    â”‚ - Actualiza tablero   â”‚   â”‚ - Ve su tablero        â”‚
    â”‚ - Pasa a defensa      â”‚   â”‚ - Ataque recibido      â”‚
    â”‚ - Espera turno rival  â”‚   â”‚ - Puede atacar ahora   â”‚
    â”‚   âœ… isYourTurn:false â”‚   â”‚ âœ… isYourTurn:true     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ESTADO DEL JUEGO (gameState)

### Estructura completa que se debe enviar:

```javascript
{
  // IdentificaciÃ³n
  gameId: "game_1234_xyz",
  status: "playing",           // "setup" | "playing" | "finished"
  currentTurn: 1,              // 1 o 2
  isYourTurn: true,            // Para el jugador que recibe
  winner: null,                // null o 1 o 2
  isVsAI: false,               // true si es contra IA
  
  // Tu tablero (lo que ves)
  yourBoard: {
    ships: [
      {
        id: 1,
        size: 5,
        row: 2,
        col: 1,
        orientation: "horizontal",
        placed: true,
        hits: [{row: 2, col: 1}, {row: 2, col: 2}]
      }
      // ... mÃ¡s barcos
    ],
    shots: [
      {row: 2, col: 1, isHit: true},
      {row: 3, col: 4, isHit: false}
      // ... disparos recibidos
    ]
  },
  
  // Tablero enemigo (lo que disparaste)
  opponentBoard: {
    shots: [
      {row: 5, col: 3, isHit: true},
      {row: 6, col: 2, isHit: false}
      // ... tus disparos
    ],
    sunkShips: [
      {
        id: 3,
        size: 3,
        row: 0,
        col: 0,
        orientation: "vertical"
      }
      // ... barcos hundidos visibles
    ]
  },
  
  // EstadÃ­sticas
  yourStats: {
    totalShots: 15,
    hits: 8,
    misses: 7,
    accuracy: 53.33
  },
  
  opponentStats: {
    totalShots: 12,
    hits: 3,
    misses: 9,
    accuracy: 25
  },
  
  // InformaciÃ³n de jugadores
  players: {
    player1: "Carlos",
    player2: "MarÃ­a"
  },
  
  // HistÃ³rico
  recentMoves: [
    {playerId: 1, row: 5, col: 3, isHit: true, timestamp: "..."}
    // ... Ãºltimos movimientos
  ],
  
  // Timestamps
  createdAt: "2025-11-11T...",
  updatedAt: "2025-11-11T..."
}
```

---

## âœ… CHECKLIST DE FLUJO CORRECTO

```
â–¡ Jugador 1 crea partida
  â””â”€ âœ… Recibe game-created CON gameState
  â””â”€ âœ… CÃ³digo visible en pantalla
  â””â”€ âœ… Espera a otro jugador

â–¡ Jugador 2 se une con cÃ³digo
  â””â”€ âœ… P1 recibe player-joined CON gameState actualizado
  â””â”€ âœ… P2 recibe player-joined CON su gameState
  â””â”€ âœ… Ambos ven el nombre del otro

â–¡ P1 coloca barcos
  â””â”€ âœ… EnvÃ­a place-ships
  â””â”€ âœ… Recibe ships-placed
  â””â”€ âœ… Espera a P2

â–¡ P2 coloca barcos
  â””â”€ âœ… EnvÃ­a place-ships
  â””â”€ âœ… Recibe ships-placed
  â””â”€ âœ… Backend detecta ambos listos

â–¡ Ambos reciben game-ready
  â””â”€ âœ… Muestra botÃ³n "Iniciar Juego"
  â””â”€ âœ… Primera persona en atacar: P1 (por defecto)

â–¡ P1 realiza disparo
  â””â”€ âœ… EnvÃ­a make-shot
  â””â”€ âœ… P1 recibe shot-result con gameState(isYourTurn: false)
  â””â”€ âœ… P2 recibe shot-result con gameState(isYourTurn: true)
  â””â”€ âœ… P1 ve tablero enemigo actualizado
  â””â”€ âœ… P2 ve su tablero actualizado

â–¡ P2 realiza disparo
  â””â”€ âœ… Respuesta similar alternada

â–¡ Se hunde un barco
  â””â”€ âœ… opponentBoard.sunkShips se actualiza
  â””â”€ âœ… Ambos ven el barco hundido

â–¡ Alguien gana
  â””â”€ âœ… Reciben game-over CON winner
  â””â”€ âœ… Se navega a /ganaste o /perdiste
  â””â”€ âœ… Partida se limpia en servidor
```

---

## ğŸ› PROBLEMAS COMUNES DESPUÃ‰S DE CORRECCIONES

| Problema | SÃ­ntoma | SoluciÃ³n |
|----------|---------|----------|
| Turnos no alternados | Siempre es mi turno | Verificar `currentTurn` en respuesta |
| Barcos no se muestran | Panel de barcos vacÃ­o | Verificar `gameState.yourBoard.ships` |
| Disparos no registran | Click no funciona | Verificar `isYourTurn` y `status: "playing"` |
| Desconexiones frecuentes | Socket se cierra | Verificar ngrok URL y reconexiÃ³n |
| Multiplayer no sincroniza | P1 no ve cambios de P2 | Verificar que ambos reciben eventos |

